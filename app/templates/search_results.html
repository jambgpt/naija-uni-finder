<!-- app/templates/search_results.html -->
{% extends "base.html" %} {% block title %}Search Results - Naija! Find Uni{%
endblock %} {% block extra_head %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/search_results.css') }}"
/>
{% endblock %} {% block content %}
<!-- Hero Section -->
<section class="hero-section search-hero-section">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-8 text-center">
        <h1 class="mb-4">Search Results</h1>
        <form
          class="d-flex justify-content-center"
          action="{{ url_for('main.search_results') }}"
          method="GET"
        >
          <div class="input-group input-group-lg" style="max-width: 600px">
            <input
              type="text"
              class="form-control"
              name="q"
              value="{{ query }}"
              placeholder="Search institutions or courses..."
            />
            <button class="btn btn-primary" type="submit">
              <i class="fas fa-search me-2"></i>Search
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</section>

<div class="container">
  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="text-center">
      <div class="spinner-border text-primary mb-3" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mb-0">Loading results...</p>
    </div>
  </div>

  <div class="row">
    <!-- Filters Sidebar -->
    <div class="col-lg-3 mb-4">
      <div class="filter-section">
        <h4 class="mb-4">Filters</h4>
        <form id="filterForm">
          <!-- State Filter -->
          <div class="filter-group">
            <label class="fw-bold mb-2">State</label>
            <select class="form-select" id="stateFilter" name="state">
              <option value="">All States</option>
              {% for state in states %}
              <option value="{{ state }}">{{ state }}</option>
              {% endfor %}
            </select>
          </div>

          <!-- Institution Type Filter -->
          <div class="filter-group">
            <label class="fw-bold mb-2">Institution Type</label>
            <div class="custom-checkboxes">
              {% for type in institution_types %}
              <label class="custom-checkbox">
                <input type="checkbox" name="type" value="{{ type }}" />
                {{ type|title }}
              </label>
              {% endfor %}
            </div>
          </div>

          <!-- Program Level Filter -->
          <div class="filter-group">
            <label class="fw-bold mb-2">Program Level</label>
            <div class="custom-checkboxes">
              {% for level in program_levels %}
              <label class="custom-checkbox">
                <input type="checkbox" name="level" value="{{ level }}" />
                {{ level|title }}
              </label>
              {% endfor %}
            </div>
          </div>

          <button type="submit" class="btn btn-primary w-100">
            <i class="fas fa-filter me-2"></i>Apply Filters
          </button>
        </form>
      </div>
    </div>

    <!-- Results Section -->
    <div class="col-lg-9">
      <!-- Results Count -->
      <div class="results-count">
        Found {{ total_results }} results for "{{ query }}"
      </div>

      <!-- Results Tabs -->
      <ul class="nav nav-tabs" id="resultTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button
            class="nav-link active"
            id="institutions-tab"
            data-bs-toggle="tab"
            data-bs-target="#institutions"
            type="button"
            role="tab"
          >
            <i class="fas fa-university me-2"></i>Institutions ({{
            universities_count }})
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button
            class="nav-link"
            id="courses-tab"
            data-bs-toggle="tab"
            data-bs-target="#courses"
            type="button"
            role="tab"
          >
            <i class="fas fa-book me-2"></i>Courses ({{ courses_count }})
          </button>
        </li>
      </ul>

      <!-- Tab Content -->
      <div class="tab-content" id="resultTabsContent">
        <!-- Institutions Tab -->
        <div
          class="tab-pane fade show active"
          id="institutions"
          role="tabpanel"
        >
          {% if universities %}
          <div class="row g-4">
            {% for university in universities %}
            <div class="col-md-6">
              <div class="result-card">
                <div class="card-body">
                  <div
                    class="d-flex justify-content-between align-items-start mb-3"
                  >
                    <h5 class="card-title mb-0">
                      {{ university.university_name }}
                    </h5>
                    <span
                      class="institution-type type-{{ university.program_type|lower }}"
                    >
                      {{ university.program_type }}
                    </span>
                  </div>
                  <p class="card-text">
                    <i class="fas fa-map-marker-alt me-2 text-primary"></i>{{
                    university.state }}
                  </p>
                  <div class="mt-3">
                    <a
                      href="{{ url_for('university.institution_details', id=university.id) }}"
                      class="btn btn-primary w-100"
                    >
                      <i class="fas fa-info-circle me-2"></i>View Details
                    </a>
                  </div>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
          {% else %}
          <div class="no-results">
            <i class="fas fa-university mb-3"></i>
            <h3>No Institutions Found</h3>
            <p class="text-muted">
              Try adjusting your search criteria or filters
            </p>
          </div>
          {% endif %}
        </div>

        <!-- Courses Tab -->
        <div class="tab-pane fade" id="courses" role="tabpanel">
          {% if courses %}
          <div class="row g-4">
            {% for course in courses %}
            <div class="col-md-6">
              <div class="result-card">
                <div class="card-body">
                  <h5 class="card-title mb-3">{{ course.course_name }}</h5>
                  <p class="card-text mb-2">
                    <i class="fas fa-university me-2 text-primary"></i>{{
                    course.university_name }}
                  </p>
                  <p class="card-text mb-3">
                    <i class="fas fa-graduation-cap me-2 text-success"></i>{{
                    course.abbrv }}
                  </p>
                  <button
                    class="btn btn-primary w-100"
                    data-bs-toggle="modal"
                    data-bs-target="#courseModal{{ course.id }}"
                  >
                    <i class="fas fa-info-circle me-2"></i>View Requirements
                  </button>
                </div>
              </div>
            </div>

            <!-- Course Modal -->
            <div
              class="modal fade course-modal"
              id="courseModal{{ course.id }}"
              tabindex="-1"
              data-course-id="{{ course.id }}"
            >
              <div class="modal-dialog modal-lg">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title">{{ course.course_name }}</h5>
                    <button
                      type="button"
                      class="btn-close"
                      data-bs-dismiss="modal"
                    ></button>
                  </div>
                  <div class="modal-body">
                    <!-- Course details will be loaded here -->
                  </div>
                  <div class="modal-footer">
                    <a href="#" class="btn btn-primary view-institution-btn">
                      <i class="fas fa-university me-2"></i>View Institution
                    </a>
                    <button
                      type="button"
                      class="btn btn-secondary"
                      data-bs-dismiss="modal"
                    >
                      Close
                    </button>
                  </div>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
          {% else %}
          <div class="no-results">
            <i class="fas fa-book mb-3"></i>
            <h3>No Courses Found</h3>
            <p class="text-muted">
              Try adjusting your search criteria or filters
            </p>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Mobile Filter Toggle -->
<button type="button" class="filter-toggle d-lg-none" id="filterToggleBtn" aria-label="Show filters">
    <i class="fas fa-filter"></i>
</button>

<!-- Mobile Filters Modal -->
<div class="modal fade" id="mobileFiltersModal" tabindex="-1" aria-labelledby="filterModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen-sm-down">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="filterModalLabel">
                    <i class="fas fa-filter me-2"></i>Filters
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="mobileFilterModalBody">
                <!-- Filter form will be cloned here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="mobileApplyFiltersBtn">
                    <i class="fas fa-check me-2"></i>Apply Filters
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %} {% block extra_scripts %}
<script src="{{ url_for('static', filename='js/search_results.js') }}"></script>
<script src="{{ url_for('static', filename='js/search_results_filter.js') }}"></script>
{% endblock %}
